define(["jquery","DoughBaseComponent","eventsWithPromises","mediaQueries"],function(t,e,s,i){"use strict";var r,a={triggersWrapper:"[data-dough-tabselector-wrapper]",triggers:"[data-dough-tabselector-triggers]",trigger:"data-dough-tabselector-trigger",target:"data-dough-tabselector-target",activeClass:"is-active",inactiveClass:"is-inactive"},n={"click [data-dough-tabselector-trigger]":"_handleClickEvent"},o={selected:"selected"};return r=function(e,s){var i;this.uiEvents=n,r.baseConstructor.apply(this,arguments),this.i18nStrings=s&&s.i18nStrings?s.i18nStrings:o,this.selectors=t.extend(this.selectors||{},a),this.$triggersContainer=this.$el.find(a.triggers).addClass(this.selectors.inactiveClass),this._setupAccessibility(),i=this.$triggersContainer.find("["+a.trigger+"]").first(),i.length&&this._updateTriggers(i.attr(a.trigger)),this._setTriggerContainerHeight(),this._subscribeHubEvents()},e.extend(r),r.prototype.init=function(t){var e;return e=this.$triggersContainer.find("["+a.trigger+"]").first(),e.length?this._initialisedSuccess(t):this._initialisedFailure(t),this},r.prototype._setupAccessibility=function(){this.$el.find("["+a.target+"]").attr({"aria-hidden":"true",tabindex:"-1"}),this._convertLinksToButtons()},r.prototype._setTriggerContainerHeight=function(){this.$el.find(a.triggersWrapper).height(this.$triggersContainer.outerHeight())},r.prototype._subscribeHubEvents=function(){var e=this;s.subscribe("mediaquery:resize",function(s){-1!==t.inArray(s.newSize,["mq-xs","mq-s"])&&e.$triggersContainer.removeClass(e.selectors.activeClass).addClass(e.selectors.inactiveClass)})},r.prototype._convertLinksToButtons=function(){this.$el.find("["+this.selectors.trigger+"] a").each(function(){var e=t(this).html();t(this).replaceWith('<button class="unstyled-button" type="button">'+e+"</button>")})},r.prototype._handleClickEvent=function(e){var s,i=t(e.currentTarget);return this._deSelectItem(this.$el.find("["+a.trigger+"].is-active")),s=i.attr(a.trigger),this._updateTriggers(s),this._positionMenu(i),this._updateTargets(s),this._toggleMenu(i),e.preventDefault(),this},r.prototype._deSelectItem=function(t){return t.removeClass(this.selectors.activeClass).addClass(this.selectors.inactiveClass).attr("aria-selected",!1),this},r.prototype._toggleMenu=function(t){return t.closest(this.$triggersContainer).length||this.$triggersContainer.hasClass(this.selectors.activeClass)?(this.$triggersContainer.toggleClass(this.selectors.activeClass).toggleClass(this.selectors.inactiveClass),this._positionMenu(t),this):void 0},r.prototype._positionMenu=function(t){var e;return t&&(e=this.$triggersContainer.hasClass(this.selectors.activeClass)?-1*t.position().top:0,t.length&&this.$triggersContainer.css("top",e)),this},r.prototype._updateTriggers=function(t){var e=this.$el.find("["+a.trigger+'="'+t+'"]'),s=this.$el.find("["+a.trigger+"]").not(e);return e.removeClass(this.selectors.inactiveClass).addClass(this.selectors.activeClass).find("button").width("auto").attr({"aria-selected":"true"}).append('<span class="visually-hidden"> '+this.i18nStrings.selected+"</span>"),s.removeClass(this.selectors.activeClass).addClass(this.selectors.inactiveClass).find("button").attr("aria-selected","false").find(".visually-hidden").remove(),this},r.prototype._updateTargets=function(t){var e=this.$el.find("["+a.target+'="'+t+'"]'),s=this.$el.find("["+a.target+"]").not("["+a.target+'="'+t+'"]');return e.removeClass(this.selectors.inactiveClass).addClass(this.selectors.activeClass).attr({"aria-hidden":"false",tabindex:0}),this._focusTarget(e),s.removeClass(this.selectors.activeClass).addClass(this.selectors.inactiveClass).attr({"aria-hidden":"true",tabindex:-1}),this},r.prototype._focusTarget=function(e){var s;i.atSmallViewport()||(s=t(window).scrollTop(),e.focus(),t("html,body").scrollTop(s))},r});